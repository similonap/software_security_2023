<!DOCTYPE html>
<html>
<head>
<title>instructies_2.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<!-- 
DISCLAIMER:

!!!!

GEBRUIK NIET DIT BESTAND OM HET LABO TE MAKEN MAAR GEBRUIK DE LINK OP DIGITAP!

!!!!
-->
<style>
.holder_default {
    width:500px; 
    height:150px; 
    border: 3px dashed #ccc;
}

.hover { 
    width:400px; 
    height:150px; 
    border: 3px dashed #0c0 !important; 
}

.hidden {
    visibility: hidden;
}

.visible {
    visibility: visible;
}
</style>
<script type="application/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
<div id="alles">
<h1 id="httpsssl-2">HTTPS/SSL 2</h1>
<h2 id="httphttps-2">HTTP/HTTPS 2</h2>
<h3 id="wat-ga-je-leren-in-dit-labo">Wat ga je leren in dit labo?</h3>
<ul>
<li>Wireshark installeren en gebruiken.</li>
<li>Wireshark gebruiken om paketten te sniffen verstuurd via onbeveiligde http.</li>
<li>Het verschil begrijpen tussen http en https.</li>
</ul>
<h3 id="stappenplan">Stappenplan</h3>
<ol>
<li>
<p>We gaan verder op het vorige labo van https/ssl. Hier hebben we een webserver opgezet met https dat gebruik maakt van een self signed certificate. Zorg ervoor dat alle stappen van het vorige labo zijn uitgevoerd.</p>
</li>
<li>
<p>Pas http.js aan zodat we terug TLS 1.3 gebruiken.</p>
<p><code>secureProtocol  : 'TLS_method'</code></p>
</li>
<li>
<p>Start de webserver op met</p>
<p><code>node http.js</code></p>
</li>
<li>
<p>Open je browser (liefst chrome) op de adressen die in de terminal zijn gegeven.</p>
<p>Op http://localhost:3000 zal je een website te zien krijgen die twee links bevat: &quot;Form with GET&quot; en &quot;Form with POST&quot;.</p>
<p>Op https://localhost:3001 krijg je de beveiligde versie van deze website te zien. Als je het labo vorige keer correct hebt uitgevoerd krijg je hier geen errors of warnings meer.</p>
</li>
<li>
<p>Sluit de webserver terug af door CTRL-C te drukken in je terminal venster.</p>
</li>
<li>
<p>Installeer wireshark:
https://www.wireshark.org/. Als er gevraagd wordt of je ncap adapter wil installeren doe dit ook anders kan je niet naar je localhost capturen.</p>
 <iframe src="https://ap.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=1194de02-db5b-4971-94ea-ab8501537469&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&start=0&interactivity=all" width=420 height=236 style="border: 1px solid #464646;" allowfullscreen allow="autoplay"></iframe>
 <iframe src="https://ap.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=e6a5cca4-f1ea-4b3c-b98b-ab850151ffa4&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&start=0&interactivity=all" width=420 height=236 style="border: 1px solid #464646;" allowfullscreen allow="autoplay"></iframe>
</li>
<li>
<p>Als alles ge√Ønstalleerd is start je wireshark op. Bekijk eerst het filmpje over filteren in wireshark:</p>
<iframe src="https://ap.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=50f56683-e4e5-43d5-8bff-ab870155f73f&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&start=0&interactivity=all" width=420 height=236 style="border: 1px solid #464646;" allowfullscreen allow="autoplay"></iframe>
</li>
<li>
<p>Dubbelklik op de loopback interface:</p>
<img src="loopback.png" width="400">
<p>In windows heet dit &quot;Adapter for loopback traffic capture&quot; (of iets gelijkaardig)</p>
<img src="loopback_windows.png" width="400">
<p>De loopback interface is een &quot;virtuele netwerkkaart&quot;. Omdat onze webserver enkel lokaal draait op localhost, gaan we deze interface moeten gebruiken om paketten te onderscheppen tussen onze browser en de webserver.</p>
</li>
<li>
<p>Wireshark maakt het mogelijk om alle netwerk paketten individueel op te vangen en lezen. Vanaf je de loopback interface hebt gekozen zal je direct zien dat er paketten in de lijst komen te staan.</p>
</li>
<li>
<p>Zorg ervoor dat je enkel de paketten te zien krijgt op poort 3000 door in de balk bovenaan: <code>tcp.port == 3000</code> in te typen.</p>
<img src="port3000.png" width="400">
</li>
<li>
<p>Ga naar http://localhost:3000/get en probeer met een login en paswoord in te loggen (willekeurig)</p>
</li>
<li>
<p>Zoek het pakket voor deze GET en zoek achter het paswoord dat je hebt ingegeven. Deze paketten zullen niet altijd direct te vinden zijn, dus wat speurwerk kan nodig zijn.</p>
<p>Je kan ook zoeken achter paketten door Find Packet te doen (ctrl-f).</p>
<img src="search.png" width="400">
</li>
<li>
<p>Maak een screenshot van het gevonden pakket en sleep deze hier onder in. Zorg ervoor dat het passwoord en login zichtbaar is.</p>
<div id="holder" style="" class="holder_default">
      <img src="" id="holder_image_droped"  style="max-width:80%; border: 3px dashed #7A97FC;" class=" hidden"/>
</div>
<script>
    $(document).ready(function() {
        addDrop('holder')
    });
</script>
</li>
<li>
<p>Waarom kon je dit paswoord gewoon clear text zien?</p>
<textarea style="width: 100%;" rows="2">
</textarea>
</li>
<li>
<p>Verander nu de filter in de balk bovenaan zodat je de ssl handshake kan zien.</p>
</li>
<li>
<p>Ga nu naar https://localhost:3001 en kijk nu een wireshark dat je de paketten te zien krijgt. Neem een screenshot waar duidelijk het <code>Client Hello</code> en het <code>Server Hello</code> pakket op te zien is (gebruik een pijl).</p>
<p>Sleep deze screenshot hier onder in:</p>
<div id="holder2" style="" class="holder_default">
      <img src="" id="holder2_image_droped"  style="max-width:80%; border: 3px dashed #7A97FC;" class=" hidden"/>
</div>
<script>
    $(document).ready(function() {
        addDrop('holder2')
    });
</script>
</li>
<li>
<p>Open een <code>Client Hello</code> pakket door er op te dubbelklikken. Zoek het <code>transport layer security</code> deel van het paket en klap dat open.</p>
<p>Welke Cipher Suites worden ondersteunt door je browser volgens deze Client Hello?</p>
<textarea style="width: 100%;" rows="15">
</textarea>
<p><strong>Tip:</strong> Je kan dit kopieren door rechter muisknop te klikken en dan Copy all selected tree items te kiezen.</p>
<p>Wat wordt er bedoeld met deze Cipher Suites en waarom stuurt onze browser deze door met het <code>Client Hello</code> bericht:</p>
<textarea style="width: 100%;" rows="5">
</textarea>
<p>Welke versies van TLS ondersteunt je browser (zoek naar Extension: supported_version)</p>
<textarea style="width: 100%;" rows="5">
</textarea>
</li>
<li>
<p>Open nu een <code>Server Hello</code> pakket door er op te dubbelklikken. Zoek het <code>transport layer security</code> deel van het paket en klap dat open.</p>
<p>Welke Cipher Suite heeft de server gekozen:</p>
<textarea style="width: 100%;" rows="2">
</textarea>
</li>
<li>
<p>Verander nu de filter in de balk bovenaan naar: <code>tcp.port == 3001</code></p>
</li>
<li>
<p>Ga nu naar https://localhost:3001/get en probeer in te loggen met eender welk login en passwoord.</p>
</li>
<li>
<p>Als je nu gaat zoeken in de paketten die hij gesniffed heeft zal je opmerken dat je deze niet meer vind. Waarom is dit?</p>
<textarea style="width: 100%;" rows="5">
</textarea>
</li>
<li>
<p>Jouw browser en de server spreken normaal gezien altijd de meest veilige cipher suite (encryptie algoritme) af tijdens de handshake. We gaan nu bewust een zwakkere kiezen, zodat we deze toch kunnen uitlezen via wireshark.</p>
</li>
<li>
<p>Pas de options aan in http.js zodat ze deze properties bevat:</p>
<pre><code>```
ciphers: 'TLS_RSA_WITH_AES_256_CBC_SHA',
secureProtocol  : 'TLSv1_method',
```
</code></pre>
<p>Als je nog herinnert, volgens de website van ssllabs.com stond TLS_RSA_WITH_AES_256_CBC_SHA gemarkeerd als WEAK:</p>
<img src="weak.png" width="400">
<p>Het ideale voorbeeld dus!</p>
</li>
<li>
<p>Herstart de http server.</p>
</li>
<li>
<p>Ga terug naar wireshark en ga naar preferences (in Edit). Of druk CTRL-SHIFT-P</p>
</li>
<li>
<p>Ga naar Protocols en daarna TLS. Vervolgens ga je naar <code>RSA keys list</code> en druk je op Edit.</p>
<img src="rsakeylist.png" width="400">
<p>en dan druk je op het + knopje.</p>
</li>
<li>
<p>Daar vul je de volgende waarden in:</p>
<ul>
<li>IP Address: 0.0.0.0</li>
<li>Port: 0</li>
<li>Protocol: http</li>
<li>Key File: <em>de locatie van je key.pem bestand</em></li>
</ul>
<img src="tls_decrypt.png" width="400">
</li>
<li>
<p>Als je nu surft naar https://localhost:3001 en je logt in dan zal je terug in wireshark de paketten kunnen lezen. Dit is omdat de cipher suite die je gebruikt niet veilig is. Als iemand in bezit is van de private sleutel, kan die dus toch alles uitlezen.</p>
</li>
<li>
<p>Maak een screenshot waarmee je bewijst dat je nu terug je login en paswoord kan zien in wireshark als je inlogt in sleep deze hieronder in:</p>
<div id="holder3" style="" class="holder_default">
      <img src="" id="holder3_image_droped"  style="max-width:80%; border: 3px dashed #7A97FC;" class=" hidden"/>
</div>
<script>
    $(document).ready(function() {
        addDrop('holder3')
    });
</script>
</li>
<li>
<p>Als je nu terug een sterkere cipher suite kiest en de TSL versie terug verhoogt naar 1.3 met</p>
<pre class="hljs"><code><div>    ciphers: 'TLS_AES_256_GCM_SHA384',
    secureProtocol  : 'TLS_method',
</div></code></pre>
<p>dan zal je zien dat je de berichten zelfs niet meer kan lezen met de private key.</p>
</li>
<li>
<p>Print deze pagina af als PDF en slaag deze op als <code>naam_voornaam_labo_https_ssl.pdf</code>.</p>
<p>Stuur deze vervolgens in via digitap!</p>
</li>
</ol>
<script>
function addDrop(id) {
    var holder = document.getElementById(id);
    holder.ondragover = function () { this.className = 'hover'; return false; };
    holder.ondrop = function (e) {
      this.className = 'hidden';
      e.preventDefault();
      var file = e.dataTransfer.files[0];
      var reader = new FileReader();
      reader.onload = function (event) {
          document.getElementById(id + '_image_droped').className='visible'
          $('#' + id + '_image_droped').attr('src', event.target.result);
      }
      reader.readAsDataURL(file);
    };
}
</script>
</body>
</html>
